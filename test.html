<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test - Hide Comments & Approval Status</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .test-result { margin: 5px 0; padding: 8px; background: white; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Feature Tests - GitHub PR Combiner</h1>
    
    <div class="test-section">
        <h2>Test 1: Hidden Comments LocalStorage</h2>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: XSS Protection in PR List</h2>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Jump Link Format</h2>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: Approval Badge Classes</h2>
        <div id="test4-result"></div>
    </div>

    <script>
        function testResult(id, message, pass) {
            const el = document.getElementById(id);
            const statusClass = pass ? 'pass' : 'fail';
            const statusText = pass ? '✓ PASS' : '✗ FAIL';
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<span class="' + statusClass + '">' + statusText + '</span>: ' + message;
            el.appendChild(resultDiv);
        }

        // Test 1: Hidden Comments LocalStorage
        (function() {
            const HIDDEN_COMMENTS_KEY = 'hidden_comments';
            
            // Clear any existing data
            localStorage.removeItem(HIDDEN_COMMENTS_KEY);
            
            // Test storing hidden comments
            const testData = { '0-1': true, '1-3': true };
            localStorage.setItem(HIDDEN_COMMENTS_KEY, JSON.stringify(testData));
            
            // Test retrieving
            const stored = localStorage.getItem(HIDDEN_COMMENTS_KEY);
            const parsed = JSON.parse(stored);
            
            testResult('test1-result', 'LocalStorage key is correct', stored !== null);
            testResult('test1-result', 'Data can be stored and retrieved', 
                parsed['0-1'] === true && parsed['1-3'] === true);
            
            // Cleanup
            localStorage.removeItem(HIDDEN_COMMENTS_KEY);
            testResult('test1-result', 'LocalStorage can be cleared', 
                localStorage.getItem(HIDDEN_COMMENTS_KEY) === null);
        })();

        // Test 2: XSS Protection
        (function() {
            // Simulate the escapeHtml function
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            const maliciousInput = '<scr' + 'ipt>alert(1)</scr' + 'ipt>';
            const escaped = escapeHtml(maliciousInput);
            
            testResult('test2-result', 'Script tags are escaped', 
                !escaped.includes('<scr' + 'ipt>'));
            testResult('test2-result', 'Escaped output is safe', 
                escaped.includes('&lt;'));
            
            const htmlInput = '<img src=x>';
            const escapedHtml = escapeHtml(htmlInput);
            testResult('test2-result', 'HTML tags are escaped', 
                escapedHtml.includes('&lt;img'));
        })();

        // Test 3: Jump Link Format
        (function() {
            const prIndex = 5;
            const jumpLink = '#pr-' + prIndex;
            
            testResult('test3-result', 'Jump link format is correct', 
                jumpLink === '#pr-5');
            testResult('test3-result', 'Jump link uses anchor format', 
                jumpLink.startsWith('#'));
        })();

        // Test 4: Approval Badge Classes
        (function() {
            const approvedBadge = 'approval-badge approved';
            const notApprovedBadge = 'approval-badge not-approved';
            
            testResult('test4-result', 'Approved badge has correct classes', 
                approvedBadge.includes('approved'));
            testResult('test4-result', 'Not approved badge has correct classes', 
                notApprovedBadge.includes('not-approved'));
            testResult('test4-result', 'Both badges share base class', 
                approvedBadge.includes('approval-badge') && 
                notApprovedBadge.includes('approval-badge'));
        })();
    </script>
</body>
</html>
